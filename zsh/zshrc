# -*- mode: sh; coding: utf-8 -*-

##################################################
### ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰
## Emacsã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰
bindkey -e

## ^ ã§ä¸Šä½ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ç§»å‹•
## å…¥åŠ›ã®é€”ä¸­ã§ã¯é€šå¸¸ã®æ–‡å­—å…¥åŠ›ã¨ã—ã¦æ‰±ã†
function cdup-or-insert-circumflex() {
  if [[ -z "$BUFFER" ]]; then
    echo
    cd ..
    zle reset-prompt
  else
    zle self-insert '^'
  fi
}
zle -N cdup-or-insert-circumflex
bindkey '\^' cdup-or-insert-circumflex

## M-^ ã§ git ã®ãƒ¯ãƒ¼ã‚¯ãƒ„ãƒªãƒ¼ã®ãƒˆãƒƒãƒ—ã«ç§»å‹•
function cd-git-toplevel() {
  local toplevel
  if toplevel=$(git rev-parse --show-toplevel 2> /dev/null); then
    echo
    cd $toplevel
    zle reset-prompt
  fi
}
zle -N cd-git-toplevel
bindkey '^[\^' cd-git-toplevel

## ã‚³ãƒãƒ³ãƒ‰ã®å…¥åŠ›ä¸­ã«C-pã§ã€ãã®å…¥åŠ›ã§å±¥æ­´ã‚’æ¤œç´¢ã™ã‚‹
autoload history-search-end
zle -N history-beginning-search-backward-end history-search-end
zle -N history-beginning-search-forward-end history-search-end
bindkey "^P" history-beginning-search-backward-end
bindkey "^N" history-beginning-search-forward-end

## C-w ã¯ ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŒæœ‰åŠ¹ãªã¨ãã¯ kill-region ã«ã™ã‚‹
## backward-kill-word ã¯ `/' ã¨ `=' ã§æ­¢ã¾ã‚‹ã‚ˆã†ã«
function backward-kill-word-non-greedy {
  WORDCHARS='*?_-.[]~&;!#$%^(){}<>' zle backward-kill-word
}

function kill-region-or-backward-kill-word-non-greedy {
  if ((REGION_ACTIVE)); then
    zle kill-region
  else
    backward-kill-word-non-greedy
  fi
}

zle -N kill-region-or-backward-kill-word-non-greedy
bindkey '^W' kill-region-or-backward-kill-word-non-greedy

## å…ƒã®å‹•ä½œã¯ C-x C-w ã§
bindkey "^X^W" backward-kill-word


## ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ãƒƒã‚¯ã§ã€é€€é¿ã—ãŸã‚³ãƒãƒ³ãƒ‰ã‚’è¡¨ç¤º
function push-line-with-buffer-stack {
  POSTDISPLAY="
stack: $LBUFFER"
  zle push-line
}
zle -N push-line-with-buffer-stack
bindkey "^[q" push-line-with-buffer-stack


## Enter ã§ ls ã¨ git status ã‚’è¡¨ç¤ºã™ã‚‹
function do_enter() {
  if [ -n "$BUFFER" ]; then
    zle accept-line
    return 0
  fi
  echo
  eval ls # alias ã‚’å±•é–‹ã—ãŸã„
  if [ "$(git rev-parse --is-inside-work-tree 2> /dev/null)" = 'true' ]; then
    echo
    echo -e "\e[0;33m--- git status ---\e[0m"
    git status -sb
  fi
  zle reset-prompt
  return 0
}
zle -N do_enter
bindkey '^m' do_enter

## Alt+Enter ã§ git diff ã‚’è¡¨ç¤ºã™ã‚‹
function my-git-diff {
  git diff
  zle reset-prompt
  return 0
}
zle -N my-git-diff
bindkey "^[^m" my-git-diff

##################################################
### ãƒ’ã‚¹ãƒˆãƒª
## ãƒ¡ãƒ¢ãƒªä¸Šã®ãƒ’ã‚¹ãƒˆãƒªæ•°
export HISTSIZE=2000000

## ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹ãƒ’ã‚¹ãƒˆãƒªæ•°ã¨ãã®ãƒ•ã‚¡ã‚¤ãƒ«
export SAVEHIST=$HISTSIZE
export HISTFILE=~/var/log/zsh-history

## ãƒ’ã‚¹ãƒˆãƒªãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã ã‘ã§ãªãå®Ÿè¡Œæ™‚åˆ»ã¨å®Ÿè¡Œæ™‚é–“ã‚‚ä¿å­˜ã™ã‚‹
setopt extended_history

## åŒã˜ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’é€£ç¶šã§å®Ÿè¡Œã—ãŸå ´åˆã¯ãƒ’ã‚¹ãƒˆãƒªã«ç™»éŒ²ã—ãªã„
setopt hist_ignore_dups

## ã‚¹ãƒšãƒ¼ã‚¹ã§å§‹ã¾ã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã¯ãƒ’ã‚¹ãƒˆãƒªã«ç™»éŒ²ã—ãªã„
setopt hist_ignore_space

## ãƒ’ã‚¹ãƒˆãƒªã‹ã‚‰å†—é•·ãªã‚¹ãƒšãƒ¼ã‚¹ã‚’å‰Šé™¤ã™ã‚‹
setopt hist_reduce_blanks

## zshãƒ—ãƒ­ã‚»ã‚¹é–“ã§ãƒ’ã‚¹ãƒˆãƒªã‚’å…±æœ‰ã™ã‚‹
setopt share_history

## ã™ããƒ’ã‚¹ãƒˆãƒªãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½è¨˜ã™ã‚‹
setopt inc_append_history

## C-sã§ã®ãƒ’ã‚¹ãƒˆãƒªæ¤œç´¢ãŒæ½°ã•ã‚Œã¦ã—ã¾ã†ãŸã‚ã€å‡ºåŠ›åœæ­¢ãƒ»é–‹å§‹ç”¨ã«C-s/C-qã‚’ä½¿ã‚ãªã„
setopt no_flow_control

## å…¨ã¦ã®ãƒ’ã‚¹ãƒˆãƒªã‚’è¡¨ç¤º
function history-all { history -E 1 }



##################################################
### ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
## PROMPTå†…ã§å¤‰æ•°å±•é–‹ãƒ»ã‚³ãƒãƒ³ãƒ‰ç½®æ›ãƒ»ç®—è¡“æ¼”ç®—ã‚’å®Ÿè¡Œã™ã‚‹
setopt prompt_subst

## è‰²ã®ç°¡æ˜“è¡¨è¨˜ã®ãŸã‚
autoload -U colors
colors

## ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®çŠ¶æ…‹ã‚’è¡¨ç¤ºã™ã‚‹
## è©³ç´°ã¯ man zshcontrib
autoload -Uz add-zsh-hook
function _setup_vcs_info {
  autoload -Uz vcs_info
  zstyle ':vcs_info:*' max-exports 3
  # formats ã¯ `hg:default' ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã‚‹ã€‚ç·¨é›†ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã«ã‚ˆã£ã¦ã€`hg' ã®éƒ¨åˆ†ã®è‰²ãŒå¤‰ã‚ã‚‹ã€‚
  # get-revision ãŒ true ã ã¨ %b ãŒé•·ããªã‚‹ã®ã§ã€__branch-name__ ã¨æ›¸ã„ã¦ãŠã„ã¦å¾Œã‹ã‚‰ç½®æ›ã™ã‚‹ã€‚
  # %c stagedstr
  # %u unstagedstr
  # %s ä½¿ã£ã¦ã„ã‚‹ VCS
  # %b ãƒ–ãƒ©ãƒ³ãƒå
  # %r ãƒªãƒã‚¸ãƒˆãƒªå
  # %a ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å
  zstyle ':vcs_info:*' actionformats '%F{white}%c%u%s%f%F{white}:%f%F{green}__branch-name__%f:%F{magenta}%a%f%c%u' '%b' '%r'
  zstyle ':vcs_info:*' formats       '%F{white}%c%u%s%f%F{white}:%f%F{green}__branch-name__%f' '%b' '%r'
  zstyle ':vcs_info:*' enable git hg

  local check_for_changes_enabled=1
  if [[ check_for_changes_enabled -eq 1 ]]; then
    zstyle ':vcs_info:*' check-for-changes true
    zstyle ':vcs_info:hg:*' get-revision true # hg ã§ check-for-changes ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã«ã¯
    zstyle ':vcs_info:hg:*' use-simple false  # ã“ã®2ã¤ã®è¨­å®šãŒå¿…è¦
  else
    zstyle ':vcs_info:*' check-for-changes false
    zstyle ':vcs_info:hg:*' get-revision false
    zstyle ':vcs_info:hg:*' use-simple true # hexdump ãŒãªã„ã¨é€Ÿããªã‚‰ãªã„ã€‚Cygwin ã§ã¯ util-linux ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã‚ã‚‹ã€‚
  fi

  zstyle ':vcs_info:git:*' stagedstr "%F{136}"
  zstyle ':vcs_info:git:*' unstagedstr "%F{63}"
  zstyle ':vcs_info:hg:*' unstagedstr "%F{136}"

  function _update_vcs_info_message {
    vcs_info
    # get-revision ãŒ true ã ã¨ %b ãŒé•·ã„ãƒ–ãƒ©ãƒ³ãƒåã«ãªã‚‹ã®ã§ã€çŸ­ãã—ã¦ã„ã‚‹
    vcs_info_msg_0_=${vcs_info_msg_0_//__branch-name__/${vcs_info_msg_1_%%:*}}
  }

  function enable_vcs_info {
    add-zsh-hook precmd _update_vcs_info_message
  }
  function disable_vcs_info {
    add-zsh-hook -d precmd _update_vcs_info_message
  }

  if [[ $ENABLE_VCS_INFO -eq 1 ]]; then
    enable_vcs_info
  fi
}

autoload -Uz is-at-least
if is-at-least 4.3.10; then
  _setup_vcs_info
fi


function setup_prompt {
  local prompt_color
  local prompt_body
  local prompt_mark prompt_mark_normal prompt_mark_error

  if [ -z "$SSH_CONNECTION" ]; then
    prompt_body=''
    prompt_color=cyan
  else
    prompt_body="%n@${EC2_INSTANCE_NAME:-%m}"
    if [ "$EC2_INSTANCE_ENV" = "production" ]; then
      prompt_color=magenta
    else
      prompt_color=yellow
    fi
  fi

  case "$TERM" in
    dumb*|emacs*)
      PROMPT='%m%# '
      RPROMPT=''
      ;;
    *)
      PROMPT="%F{$prompt_color}${PROMPT_BODY:-$prompt_body}%f\${prompt_mark_color}\${prompt_mark}%f "
      local rprompt
      rprompt=(
        "%F{$prompt_color}["
        "\${vcs_info_msg_0_:+\${vcs_info_msg_0_} }%f" # VCS ã®æƒ…å ±ãŒã‚ã‚Œã°è¡¨ç¤º
        "%F{$prompt_color}"
        # $PWD ã¯ ~ ãŒå±•é–‹ã•ã‚Œã¦ã„ã‚‹ã®ã§ ~ ã«æˆ»ã—ã€ãƒªãƒã‚¸ãƒˆãƒªåã®éƒ¨åˆ†ã«ä¸‹ç·šã‚’ä»˜ã‘ã‚‹ã€‚
        # ãƒªãƒã‚¸ãƒˆãƒªåã¯ $vcs_info_msg_2_ ã«å…¥ã£ã¦ã„ã‚‹ã€‚
        "\${\${\${PWD/#\$HOME/~}/\/\${vcs_info_msg_2_}\///%U\${vcs_info_msg_2_}%u/}/%\/\${vcs_info_msg_2_}//%U\${vcs_info_msg_2_}%u}"
        " %*]%f"
      )
      RPROMPT=${(j..)rprompt}

      ## ã‚³ãƒãƒ³ãƒ‰ã®çµ‚äº†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«å¿œã˜ã¦ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®è‰²ã‚’å¤‰ãˆã‚‹ã€‚
      ## ä¸€åº¦è‰²é•ã„ã§è¡¨ç¤ºã—ãŸã‚‰ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå†æç”»ã®éš›ã«ã¯è‰²ã‚’æˆ»ã™ã€‚
      function setup_prompt_mark_color {
        if (( prompt_mark_displayed != 1 && $? != 0 )); then
          prompt_mark_color='%F{magenta}'
          prompt_mark="ğŸ™"
        else
          prompt_mark_color=''
          prompt_mark="ğŸ³"
        fi
        prompt_mark_displayed=1
      }
      add-zsh-hook precmd setup_prompt_mark_color

      function reset_prompt_mark_displayed {
        prompt_mark_displayed=0
      }
      add-zsh-hook preexec reset_prompt_mark_displayed
      ;;
  esac
}
setup_prompt



##################################################
### è£œå®Œ
## åˆæœŸåŒ–
autoload -U compinit
compinit -u

## è£œå®Œãƒªã‚¹ãƒˆã«è‰²ã‚’ã¤ã‘ã‚‹
if type dircolors > /dev/null; then
  eval `dircolors -b` # LS_COLORSã®è¨­å®š
  zstyle ':completion:*:default' list-colors ${(s.:.)LS_COLORS}
else
  zstyle ':completion:*:default' list-colors 'di=34;01' 'ln=35' 'so=32' 'ex=31' 'bd=46;34' 'cd=43;34'
fi
zstyle ':completion:*:*:*:*:processes' list-colors "=(#b)[^0-9]#([0-9]#)*[0-9:.]## ([^ ]#)*=$color[none]=$color[bold];$color[cyan]=$color[green]"

## è£œå®Œãƒªã‚¹ãƒˆã‚’å…¨ã¦ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘ã—ã¦è¡¨ç¤º
zstyle ':completion:*' group-name ''

## è£œå®Œãƒªã‚¹ãƒˆãŒ1ç”»é¢ã«åã¾ã‚‰ãªã‹ã£ãŸã¨ãã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
zstyle ':completion:*' list-prompt '%SAt %p: Hit TAB for more, or the character to insert%s'

## è£œå®Œãƒªã‚¹ãƒˆã§å€™è£œã®ã‚«ãƒ¼ã‚½ãƒ«é¸æŠã‚’æœ‰åŠ¹ã«
zstyle ':completion:*:default' menu select=1

## ã‚«ãƒ¼ã‚½ãƒ«é¸æŠã§å€™è£œã‚’é¸ã‚“ã§ã„ã‚‹ã¨ãã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆè£œå®Œãƒªã‚¹ãƒˆãŒ1ç”»é¢ã«åã¾ã‚‰ãªã‹ã£ãŸå ´åˆï¼‰
zstyle ':completion:*' select-prompt '%SScrolling active: current selection at %p%s'

## m:{a-z}={A-Z}: å°æ–‡å­—ã‚’å¤§æ–‡å­—ã«å¤‰ãˆãŸã‚‚ã®ã§ã‚‚è£œå®Œã™ã‚‹
#zstyle ':completion:*' matcher-list 'm:{a-z}={A-Z}'

## è£œå®Œå€™è£œã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ã€‚
zstyle ':completion:*' use-cache yes

## è©³ç´°ãªæƒ…å ±ã‚’ä½¿ã†
zstyle ':completion:*' verbose yes

## ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
zstyle ':completion:*:descriptions' format '%B%d%b' # è£œå®Œãƒªã‚¹ãƒˆã®ä¸Šã«å‡ºã¦ãã‚‹description
zstyle ':completion:*:messages' format '%d' # è£œå®Œæ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
zstyle ':completion:*:warnings' format 'No matches for: %d' # è£œå®ŒãŒãƒãƒƒãƒã—ãªã‹ã£ãŸã¨ã

## man ã®è£œå®Œã‚’ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã”ã¨ã«åŒºåˆ†ã™ã‚‹
zstyle ':completion:*:manuals' separate-sections true

## ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç•ªå·ã‚’æŒ¿å…¥ã™ã‚‹(ã‚»ã‚¯ã‚·ãƒ§ãƒ³1ä»¥å¤–)
zstyle ':completion:*:manuals.(^1*)' insert-sections true

## ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã«æ—¢ã«å…¥åŠ›ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¯è£œå®Œå¯¾è±¡ã«ã—ãªã„
zstyle ':completion:*:(rm|mv|cp|diff|kill):*' ignore-line other

## parent: foo/../ ã‹ã‚‰ foo ã‚’è£œå®Œã—ãªã„
## pwd: ../ ã‹ã‚‰ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è£œå®Œã—ãªã„
zstyle ':completion:*:(cd|mv|cp):*' ignore-parents parent pwd

## è¾æ›¸é †ã§ã¯ãªãæ•°å­—é †ã«ä¸¦ã¹ã‚‹
setopt numeric_glob_sort

## è£œå®Œãƒªã‚¹ãƒˆã‚’è©°ã‚ã¦è¡¨ç¤º
setopt list_packed

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®è£œå®Œã«ç¶šã„ã¦ãƒ‡ãƒªãƒŸã‚¿ç­‰ã‚’å…¥åŠ›ã—ãŸã¨ãã€
## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæœ«å°¾ã®ã€Œ/ã€ã‚’è‡ªå‹•çš„ã«å‰Šé™¤ã™ã‚‹
setopt auto_remove_slash



##################################################
### å±•é–‹
## --prefix=~/localã¨ã„ã†ã‚ˆã†ã«ã€Œ=ã€ã®å¾Œã§ã‚‚ãƒ•ã‚¡ã‚¤ãƒ«åå±•é–‹ã‚’è¡Œã†
setopt magic_equal_subst

## æ‹¡å¼µglobã‚’æœ‰åŠ¹ã«ã™ã‚‹
setopt extended_glob

## å±•é–‹å¾Œã®ãƒ‘ã‚¹ãŒãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã ã£ãŸã‚‰æœ€å¾Œã«ã€Œ/ã€ã‚’ã¤ã‘ã‚‹
#setopt mark_dirs

## {a-c}ã‚’a b cã«å±•é–‹ã™ã‚‹
setopt brace_ccl



##################################################
### ã‚¸ãƒ§ãƒ–
## jobsã§ãƒ—ãƒ­ã‚»ã‚¹IDã‚‚å‡ºåŠ›ã™ã‚‹
setopt long_list_jobs

## å®Ÿè¡Œã—ãŸãƒ—ãƒ­ã‚»ã‚¹ã®æ¶ˆè²»æ™‚é–“ãŒ3ç§’ä»¥ä¸Šã‹ã‹ã£ãŸã‚‰
## è‡ªå‹•çš„ã«æ¶ˆè²»æ™‚é–“ã®çµ±è¨ˆæƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹ã€‚
REPORTTIME=3



##################################################
### ã‚¨ã‚¤ãƒªã‚¢ã‚¹
alias mv='nocorrect mv'

case "$OSTYPE" in
  freebsd*)
    alias ls='ls -F -G -w'
    export LSCOLORS=ExgxfxdxCxDxDxhbadacec
    ;;
  *)
    alias ls='ls -F --color=auto --show-control-chars'
    export TIME_STYLE=long-iso
    ;;
esac

alias ll='ls -l'
alias la='ls -a'

alias be='bundle exec'


function bundle-cd {
  local output exit_status
  output=`bundle show $1`
  exit_status=$?
  if [ $exit_status -eq 0 ]; then
    cd "$output"
  else
    echo $output 1>&2
    return $exit_status
  fi
}


function man {
  # mb: blinking
  # md: bold
  # so: standout-mode
  # us: underline
  env \
    LESS_TERMCAP_mb=$'\E[01;31m' \
    LESS_TERMCAP_md=$'\E[01;38;5;76m' \
    LESS_TERMCAP_so=$'\E[48;5;94;1;37m' \
    LESS_TERMCAP_us=$'\E[04;38;5;146m' \
    LESS_TERMCAP_me=$'\E[0m' \
    LESS_TERMCAP_se=$'\E[0m' \
    LESS_TERMCAP_ue=$'\E[0m' \
    man "$@"
}

function list-colors-display {
  print -n "normal colors\t"
  echo 'e.g. \\e[30m ... \\e[0m'
  for i in {30..37}; do
    printf "\e[%d;m %3d \e[0m" i i
  done

  print -n "\nlight colors\t"
  echo 'e.g. \\e[1;30m ... \\e[0m'
  for i in {30..37}; do
    printf "\e[1;%d;m %3d \e[0m" i i
  done

  print -n "\n256 colors\t"
  echo 'e.g. 128 -> \\e[38;5;128m ... \\e[0m'
  for i in {0..255}; do
    printf "\e[38;5;%dm %3d \e[0m" i i
    (( ($i + 1) % 16 )) || echo
  done
}

## grep
typeset -a grep_options
grep_help=$(grep --help)

# ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ãƒãƒƒãƒã•ã›ãªã„ã€‚
grep_options=(--binary-files=without-match )

# ç®¡ç†ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç„¡è¦–ã™ã‚‹
if echo $grep_help | grep -q -- --exclude-dir
then
  for ext (.svn .git .hg .deps .libs)
  do
    grep_options=($grep_options --exclude-dir=${ext})
  done
fi

# å¯èƒ½ãªã‚‰è‰²ã‚’ä»˜ã‘ã‚‹ã€‚
if echo $grep_help | grep -q -- --color
then
  grep_options=($grep_options --color=auto)
fi

# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯å†å¸°çš„ã«grepã™ã‚‹
#grep_options=($grep_options --recursive)

alias grep="grep $grep_options"
unset grep_help


##################################################
### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚¹ã‚¿ãƒƒã‚¯
## cdã—ãŸã¨ãã€ç§»å‹•å‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è‡ªå‹•ã§pushdã™ã‚‹
setopt auto_pushd

## pushdã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚¹ã‚¿ãƒƒã‚¯ã«é‡è¤‡ã‚’å«ã‚ãªã„
setopt pushd_ignore_dups


### fzf
## Auto-completion
[[ $- == *i* ]] && source "/opt/homebrew/opt/fzf/shell/completion.zsh" 2> /dev/null

## Key bindings
source "/opt/homebrew/opt/fzf/shell/key-bindings.zsh"
bindkey "^O" fzf-file-widget
export FZF_DEFAULT_COMMAND='unset REPORTTIME && rg --color=never --files --no-ignore --hidden --no-messages'
export FZF_DEFAULT_OPTS='--height 40% --border'
export FZF_CTRL_T_COMMAND="${FZF_DEFAULT_COMMAND}"
export FZF_CTRL_R_OPTS='--bind=ctrl-e:accept'


### gitãƒ¯ãƒ¼ã‚¯ãƒ„ãƒªãƒ¼å†…ã«ç§»å‹•ã—ãŸã¨ãã¯ãƒ–ãƒ©ãƒ³ãƒåã‚’è¡¨ç¤º
function chpwd_show_git_branch() {
  local git_toplevel
  git_toplevel=$(git rev-parse --show-toplevel 2> /dev/null)

  # ç§»å‹•å…ˆãŒgitãƒ¯ãƒ¼ã‚¯ãƒ„ãƒªãƒ¼å†…ã§ã€ç§»å‹•å‰ã¨åˆ¥ãƒ¯ãƒ¼ã‚¯ãƒ„ãƒªãƒ¼ã ã£ãŸã‚‰
  if [[ -n $git_toplevel && $git_toplevel != $git_toplevel_prev ]]; then
    echo "## ${fg[green]}$(git rev-parse --abbrev-ref @)"
  fi

  git_toplevel_prev=${git_toplevel}
}
add-zsh-hook chpwd chpwd_show_git_branch

### ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã‚³ãƒãƒ³ãƒ‰ã§ã‚‚ run-help ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹
unalias run-help > /dev/null 2>&1 && autoload -Uz run-help


### URL ã®å…¥åŠ›ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã™ã‚‹
autoload -Uz url-quote-magic
zle -N self-insert url-quote-magic


### ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†
PACKAGE_BASE_DIR="$ZDOTDIR/packages"
source $ZDOTDIR/package.zsh
source $ZDOTDIR/package-conf/zsh-manydots-magic.zsh
source $ZDOTDIR/package-conf/zsh-git-escape-magic.zsh
#source $ZDOTDIR/package-conf/zsh-syntax-highlighting.zsh
#source $ZDOTDIR/package-conf/z.zsh


### ãƒ›ã‚¹ãƒˆã”ã¨ã®è¨­å®šã‚’èª­ã‚€
source_if_exist "${HOME}/.zsh.d/zshrc-${HOST}"
source_if_exist "${HOME}/.zsh.d/zshrc.local"


### ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰é–‹å§‹
cd
